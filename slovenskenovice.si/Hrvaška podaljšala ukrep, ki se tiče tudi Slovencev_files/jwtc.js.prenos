var jwt={};jwt.token="JWT_TOKEN";jwt.token_refresh="JWT_REFRESH";jwt.token_logout="JWT_LOGOUT";jwt.token_login="JWT_LOGIN";jwt.token_refresh_url="//uporabnik.delo.si/api-token-refresh/";jwt.token_verify="//uporabnik.delo.si/api-token-verify/";jwt.token_auth="//uporabnik.delo.si/api-token-auth/";jwt.ttl_value=8*60*60;jwt.sso_domains=["//www.delo.si/jwtc.html","//www.slovenskenovice.si/jwtc.html","//www.onaplus.si/jwtc.html","//www.micna.si/jwtc.html","//www.deloindom.si/jwtc.html","//www.polet.si/jwtc.html"];jwt.xhr=function(t,e,o,n){var w;w=new XMLHttpRequest;w.onreadystatechange=function(){if(w.readyState==4){n(w.responseText)}};w.open(t,e,true);w.setRequestHeader("Content-Type","application/json");o=JSON.stringify(o);w.send(o)};jwt.nested_split=function(t,e,o){var n={};t.split(e).forEach(function(t){var e=t.split(o);n[e[0]]=e[1]});return n};jwt.cookie={get:function(t){var e=jwt.nested_split(document.cookie,/;\s/,"=");return t||t!==""?e[t]:e},set:function(t,e,o){var n=o.toUTCString();var w=document.location.host;w=w.split(":")[0];w=parseInt(w)?[w]:w.split(".").slice(-2,w.length);w=w.length==1?w.join("."):"."+w.join(".");document.cookie=t+"="+e+"; expires="+n+";domain="+w+";path=/"}};jwt.set_remote_cookie=function(t,e){jwt.cookie.set(jwt.token_logout,"1",new Date(1));jwt.cookie.set(jwt.token_login,"1",new Date(1));var o=document.createElement("iframe");o.src=t+"?JWT="+e;o.style.cssText="display:none;";document.body.appendChild(o)};jwt.auth=function(t,e){jwt.xhr("POST",jwt.token_auth,t,function(t){try{var o=JSON.parse(t);if(o.token){try{jwt.sso_domains.map(function(t){return jwt.set_remote_cookie(t,o.token)})}catch(n){console.log(n)}}e(o)}catch(n){return e(n)}})};jwt.arg={get:function(t){var e=location.search;var o=jwt.nested_split(e.slice(1,e.length),"&","=");return t?o[t]:o}};jwt.parseJwt=function(t){var e=t.split(".")[1];var o=e.replace("-","+").replace("_","/");var n=JSON.parse(window.atob(o));n.orig_iat=n.orig_iat*1e3;n.exp=n.exp*1e3;return n};jwt.set_cookies=function(t,e){var o=new Date(t.exp);var n=(new Date).getTime();var w=(t.exp-n)/2;var i=new Date(n+w);jwt.cookie.set(jwt.token,e,o);jwt.cookie.set(jwt.token_refresh,"",i)};jwt.refresh=function(){var t,e,o,n,w,i,r,s,a="";if(jwt.cookie.get(jwt.token_login)===""||jwt.cookie.get(jwt.token_login)=="1"){var c=jwt.cookie.get(jwt.token);jwt.sso_domains.forEach(function(t){jwt.set_remote_cookie(t,c)});return}if(jwt.cookie.get(jwt.token_logout)===""||jwt.cookie.get(jwt.token_logout)=="1"){t="delete"}else{t=jwt.arg.get("JWT")}if(t=="delete"){jwt.cookie.set(jwt.token,"",new Date(1));jwt.cookie.set(jwt.token_refresh,"",new Date(1));e=jwt.cookie.get(jwt.token_logout);if(!e){o=new Date;o.setSeconds(o.getSeconds()+15);jwt.cookie.set(jwt.token_logout,"1",o)}return}else if(t&&t.length>10){n=decodeURIComponent(t);w=jwt.parseJwt(n);i=new Date(w.exp);r=(new Date).getTime();s=jwt.cookie.get(jwt.token);a=jwt.cookie.get(jwt.token_refresh);if(s!==n&&i>r&&!a){jwt.set_cookies(w,n)}return}else if(jwt.cookie.get(jwt.token)){n=jwt.cookie.get(jwt.token);if(n){w=jwt.parseJwt(n)}}var j=jwt.cookie.get(jwt.token_refresh)===""?false:true;if(w&&j){var l={token:n};jwt.xhr("POST",jwt.token_refresh_url,l,function(t){try{var e=JSON.parse(t);var o=jwt.cookie.get(jwt.token_logout);if(e.token&&!o){try{jwt.sso_domains.map(function(t){return jwt.set_remote_cookie(t,e.token)})}catch(n){console.log(n)}}else if(o){jwt.sso_domains.map(function(t){return jwt.set_remote_cookie(t,"delete")})}}catch(n){return n}})}if(jwt.cookie.get(jwt.token_refresh)=="logout"){jwt.logout();return}};jwt.logout=function(){jwt.sso_domains.forEach(function(t){jwt.set_remote_cookie(t,"delete")})};jwt.refreshable=function(){jwt.cookie.set(jwt.token_refresh,"",new Date)};jwt.ttl=function(){var t=new Date;t=new Date(t.setSeconds(t.getSeconds()+jwt.ttl_value));return t};document.addEventListener("DOMContentLoaded",function(){jwt.refresh()},false);window.setInterval(function(){var t=new Date;if(t<jwt.ttl())jwt.refresh()},1e4);if(window!=="undefined"){window.jwt=jwt}