var host=window.location.hostname,cmsrest=null,hostName=null,iosrest=null;switch(host){case"localhost":case"dev.delo.si":cmsrest="//push.loc:8080/services/notification/",iosrest="https://push.loc:8080/services/notification/ios",hostName="//dev.slovenskenovice.si/";break;default:cmsrest="//push.delo.si/services/notification/",iosrest="https://push.delo.si/services/notification/ios",hostName="//www.slovenskenovice.si/"}const modalLogin=document.querySelector("#login");var close=document.querySelector("#fcmClose");mess=document.querySelector("#modal_message");var isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);function getParameterByName(e){var o=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return o&&decodeURIComponent(o[1].replace(/\+/g," "))}function showModal(){isSafari||Notification.requestPermission().then(function(e){var o=window.localStorage.getItem("fcmReconfirm"),t=!!o&&o<=new Date;if("granted"===e&&1!=t)resetUI();else{value_or_null=(document.cookie.match(/^(?:.*;)?\s*JWT_TOKEN\s*=\s*([^;]+)(?:.*)?$/)||[,null])[1];"denied"==e?o||(mess.textContent="Na brskalniku imate onemogočeno prejemanje sporočil za portal DELO.SI"):t&&(mess.textContent="Pozdravljeni, če želite prejemati obvestila portala DELO.SI, kliknite na spodnjo povezavo.",window.localStorage.removeItem("fcmReconfirm"))}}).catch(function(e){console.log("Unable to get permission to notify.",e)})}function showHideDiv(e,o){const t=document.querySelector("#"+e);t.style=o?"display: visible":"display: hidden"}function deloREST(e,o,t,n){var s=JSON.stringify(e),i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return t?i.open(o,"https://"+host+"/firebase/NotificationInit.php"):i.open(o,cmsrest+"token/"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status&&n){var e=n(i.responseText);window.localStorage.setItem("firebaseconf",e||null)}},i.setRequestHeader("Access-Control-Allow-Origin","https:"+hostName),i.setRequestHeader("Content-type","application/json; charset=utf-8"),i.send(s),i}function NotificationIsSupported(){return!!(window.Notification||window.webkitNotifications||navigator.mozNotification)}function ajax_response(e){return e}function setMessage(e){console.log(e);document.querySelector("#error_message").innerHTML=e}var json={init:!0};deloREST(json,"PUT",!0,ajax_response);var conf=JSON.parse(window.localStorage.getItem("firebaseconf"));if(conf&&firebase.messaging.isSupported()){var defaultApp=firebase.initializeApp(conf);firebase.analytics();const e=firebase.messaging();e.usePublicVapidKey("BCphtPbD7PwsthG1mcGYXl1v3Am7LWM5HW49fhqUxitnlGRAItor-jopvBmxPmSDj4G28FCfnePi_Ya2APNWpZ4"),function(e,o){!function(e,o){var t=document.createElement("script");t.async=1,t.src=e;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}("https://www.gstatic.com/firebasejs/6.1.1/firebase-performance-standalone.js"),window.onload=function(){firebase.initializeApp(o).performance()}}(0,conf);function resetUI(){console.log("resetUI"),e.getToken().then(function(e){console.log(e);var o=window.localStorage.getItem("fcmReconfirm");!!o&&new Date;e?(console.log("Token avaliable."),sendTokenToServer(e),updateUIForPushEnabled(e)):(console.log("No Instance ID token available. Request permission to generate one."),updateUIForPushPermissionRequired(),setTokenSentToServer(!1))}).catch(function(e){console.log("An error occurred while retrieving token. ",e),setTokenSentToServer(!1)})}function showToken(e){document.querySelector("#token").textContent=e}function sendTokenToServer(e){if(console.log(e),!isTokenSentToServer()){console.log("Sending token to server..."),setTokenSentToServer(!0);window.localStorage.getItem("fcmoff");deloREST({token:e,topic_id:2},"PUT")}}function isTokenSentToServer(){return null!==window.localStorage.getItem("sentToServerOn")&&new Date(window.localStorage.getItem("sentToServerOn"))>new Date}function setTokenSentToServer(e){if(window.localStorage.setItem("sentToServer",e?1:0),e){var o=new Date;o.setMinutes(o.getMinutes()+10),window.localStorage.setItem("sentToServerOn",new Date(o))}}function requestPermission(){console.log("Requesting permission..."),window.localStorage.removeItem("fcmoff"),e.requestPermission().then(function(){console.log("Notification permission granted."),e.getToken().then(function(e){console.log(e),e?(sendTokenToServer(e),updateUIForPushEnabled(e)):(console.log("No Instance ID token available. Request permission to generate one."),setTokenSentToServer(!1))}).catch(function(e){console.log("An error occurred while retrieving token. ",e),setTokenSentToServer(!1)})}).catch(function(e){var o=new Date;o.setDate(o.getDate()+7),window.localStorage.setItem("fcmReconfirm",new Date(o)),setMessage("<b>Na brskalniku imate onemogočeno obveščanje. Na spodnji sliki lahko pogledate, kako spremeniti nastavitve.</b><br/><br/><img width='700' src='/templates/novice/images/delo-fcm.png' />"),console.log("Unable to get permission to notify.",e),setTokenSentToServer(!1)})}function deleteToken(){e.getToken().then(function(o){e.deleteToken(o).then(function(){console.log("Token deleted."),setTokenSentToServer(!1),deloREST({token:o},"DELETE");var e=new Date;e.setDate(e.getDate()+7),window.localStorage.setItem("fcmReconfirm",new Date(e)),window.localStorage.setItem("fcmoff",1),updateUIForPushPermissionRequired()}).catch(function(e){console.log("Unable to delete token. ",e)})}).catch(function(e){console.log("Error retrieving Instance ID token. ",e)})}function appendMessage(e){const o=document.querySelector("#messages"),t=document.createElement("h5"),n=document.createElement("pre");n.style="overflow-x:hidden;",t.textContent="Received message:",n.textContent=JSON.stringify(e,null,2),o.appendChild(t),o.appendChild(n)}function clearMessages(){const e=document.querySelector("#messages");for(;e.hasChildNodes();)e.removeChild(e.lastChild)}function updateUIForPushEnabled(e){value_or_null=(document.cookie.match(/^(?:.*;)?\s*JWT_TOKEN\s*=\s*([^;]+)(?:.*)?$/)||[,null])[1]}function updateUIForPushPermissionRequired(){}e.onTokenRefresh(function(){e.getToken().then(function(e){console.log("Token refreshed."),setTokenSentToServer(!1),sendTokenToServer(e),resetUI()}).catch(function(e){console.log("Unable to retrieve refreshed token ",e)})})}showModal();